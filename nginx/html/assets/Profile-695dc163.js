import{E as e,G as a,u as l,S as u,w as d,B as s,H as r,a7 as t,b as o,V as i,a3 as n,X as m,O as v,K as f,L as p,af as c,a6 as g}from"./elementPlus-e3fc6f82.js";import{u as b,_}from"./index-4bf8c7f1.js";import{g as V,u as q}from"./auth-ef5ad292.js";import{f as h}from"./errorHandler-e80e1e70.js";import{x as y,c as N,r as w,X as x,k as U,z as j,P as Q,H as k,y as I,A as P,u as M,M as T,L as z,G as C}from"./vue-4e979bb7.js";import"./request-811deccb.js";const H={class:"profile-container"},O={class:"profile-content"},A={class:"profile-header"},B={class:"avatar-section"},F={class:"user-basic-info"},G={class:"user-role"},L={class:"profile-form-section"},X={class:"section-header"},D={key:1,class:"edit-actions"},E=_(y({__name:"Profile",setup(_){const y=b(),E=N((()=>y.userInfo)),K=w(!1),R=w(!1),S=w(!1),$=w(),J=w({id:0,loginName:"",tenantId:0,tenantName:"",orgId:0,orgName:"",level:1,userName:"",userPhone:"",userMail:"",gender:0,weixin:"",qq:"",createBy:0,createTime:0,updateTime:0}),W=x({id:0,userName:"",level:1,gender:0,weixin:"",qq:""}),Y=x({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:50,message:"用户名长度在 2 到 50 个字符",trigger:"blur"}],level:[{required:!0,message:"请输入职级",trigger:"blur"},{type:"number",min:1,max:10,message:"职级范围在 1 到 10",trigger:"blur"}],weixin:[{max:50,message:"微信号长度不超过 50 个字符",trigger:"blur"}],qq:[{max:20,message:"QQ号长度不超过 20 个字符",trigger:"blur"},{pattern:/^\d*$/,message:"QQ号只能包含数字",trigger:"blur"}]}),Z=async()=>{K.value=!0;try{const a=await V();console.log("获取个人资料响应:",a),200===a.code&&a.data?(J.value=a.data,Object.assign(W,{id:a.data.id,userName:a.data.userName,level:a.data.level,gender:a.data.gender,weixin:a.data.weixin,qq:a.data.qq})):e.error(a.message||"获取个人资料失败")}catch(a){console.error("获取个人资料失败:",a),e.error("获取个人资料失败")}finally{K.value=!1}},ee=()=>{S.value=!0,Object.assign(W,{id:J.value.id,userName:J.value.userName,level:J.value.level,gender:J.value.gender,weixin:J.value.weixin,qq:J.value.qq})},ae=()=>{var e;S.value=!1,null==(e=$.value)||e.resetFields()},le=async()=>{$.value&&await $.value.validate((async a=>{if(a){R.value=!0;try{const a=await q(W);console.log("更新个人资料响应:",a),200===a.code?(e.success("个人资料更新成功"),S.value=!1,await Z(),await y.getUserInfoAction()):e.error(a.message||"更新个人资料失败")}catch(l){console.error("更新个人资料失败:",l),e.error("更新个人资料失败")}finally{R.value=!1}}}))};return U((()=>{Z()})),(e,b)=>{const _=d,V=s,q=r,y=t,N=o,w=i,x=n,U=m,Z=v,ue=f,de=p,se=c,re=g,te=a;return I(),j("div",H,[Q(te,{class:"profile-card"},{header:k((()=>b[10]||(b[10]=[P("div",{class:"card-header"},[P("h2",null,"个人中心"),P("p",{class:"subtitle"},"管理您的个人信息和账户设置")],-1)]))),default:k((()=>{var e;return[P("div",O,[P("div",A,[P("div",B,[Q(V,{size:100,src:E.value.avatar,class:"user-avatar"},{default:k((()=>[Q(_,null,{default:k((()=>[Q(M(l))])),_:1})])),_:1},8,["src"]),P("div",F,[P("h3",null,T(E.value.username||J.value.userName||"未设置"),1),P("p",G,T((null==(e=E.value.roles)?void 0:e[0])||"普通用户"),1),Q(q,{type:"info",size:"small"},{default:k((()=>[z("用户ID: "+T(J.value.id||"-"),1)])),_:1})])])]),Q(y),P("div",L,[P("div",X,[b[14]||(b[14]=P("h4",null,"基本信息",-1)),S.value?(I(),j("div",D,[Q(N,{onClick:ae},{default:k((()=>b[12]||(b[12]=[z("取消")]))),_:1}),Q(N,{type:"primary",onClick:le,loading:R.value},{default:k((()=>b[13]||(b[13]=[z("保存")]))),_:1},8,["loading"])])):(I(),C(N,{key:0,type:"primary",icon:M(u),onClick:ee,loading:K.value},{default:k((()=>b[11]||(b[11]=[z(" 编辑资料 ")]))),_:1},8,["icon","loading"]))]),Q(re,{ref_key:"profileFormRef",ref:$,model:W,rules:Y,"label-width":"120px",class:"profile-form",disabled:!S.value},{default:k((()=>[Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"登录账号"},{default:k((()=>[Q(w,{modelValue:J.value.loginName,"onUpdate:modelValue":b[0]||(b[0]=e=>J.value.loginName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"用户名",prop:"userName"},{default:k((()=>[Q(w,{modelValue:W.userName,"onUpdate:modelValue":b[1]||(b[1]=e=>W.userName=e),placeholder:"请输入用户名",disabled:!S.value},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"手机号"},{default:k((()=>[Q(w,{modelValue:J.value.userPhone,"onUpdate:modelValue":b[2]||(b[2]=e=>J.value.userPhone=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"邮箱地址"},{default:k((()=>[Q(w,{modelValue:J.value.userMail,"onUpdate:modelValue":b[3]||(b[3]=e=>J.value.userMail=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"性别",prop:"gender"},{default:k((()=>[Q(de,{modelValue:W.gender,"onUpdate:modelValue":b[4]||(b[4]=e=>W.gender=e),placeholder:"请选择性别",disabled:!S.value,style:{width:"100%"}},{default:k((()=>[Q(ue,{label:"男",value:0}),Q(ue,{label:"女",value:1})])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"职级",prop:"level"},{default:k((()=>[Q(se,{modelValue:W.level,"onUpdate:modelValue":b[5]||(b[5]=e=>W.level=e),min:1,max:10,placeholder:"请输入职级",disabled:!S.value,style:{width:"100%"}},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"微信号",prop:"weixin"},{default:k((()=>[Q(w,{modelValue:W.weixin,"onUpdate:modelValue":b[6]||(b[6]=e=>W.weixin=e),placeholder:"请输入微信号",disabled:!S.value},null,8,["modelValue","disabled"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"QQ号",prop:"qq"},{default:k((()=>[Q(w,{modelValue:W.qq,"onUpdate:modelValue":b[7]||(b[7]=e=>W.qq=e),placeholder:"请输入QQ号",disabled:!S.value},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"租户名称"},{default:k((()=>[Q(w,{modelValue:J.value.tenantName,"onUpdate:modelValue":b[8]||(b[8]=e=>J.value.tenantName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"组织名称"},{default:k((()=>[Q(w,{modelValue:J.value.orgName,"onUpdate:modelValue":b[9]||(b[9]=e=>J.value.orgName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),Q(Z,{gutter:20},{default:k((()=>[Q(U,{span:12},{default:k((()=>[Q(x,{label:"创建时间"},{default:k((()=>[Q(w,{value:M(h)(J.value.createTime),disabled:""},null,8,["value"])])),_:1})])),_:1}),Q(U,{span:12},{default:k((()=>[Q(x,{label:"更新时间"},{default:k((()=>[Q(w,{value:M(h)(J.value.updateTime),disabled:""},null,8,["value"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","disabled"])])])]})),_:1})])}}}),[["__scopeId","data-v-e77e3cc1"]]);export{E as default};
