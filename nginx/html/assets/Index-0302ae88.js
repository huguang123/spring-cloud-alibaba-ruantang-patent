import{x as e,r as a,X as l,c as t,k as n,h as d,z as u,P as s,H as i,u as o,ax as r,y as m,A as v,L as p,M as c,I as f,G as y,C as h,O as g,a4 as b,a5 as _,K as w}from"./vue-4e979bb7.js";import{X as T,G as C,aa as V,ab as I,L as x,K as U,V as k,w as N,U as M,b as A,Q as P,$ as D,H as E,a1 as $,a2 as S,a0 as z,_ as j,Z as q,Y as H,O as L,a6 as Y,a3 as R,a8 as F,P as K,E as O,a5 as G,J as X,a9 as Z}from"./elementPlus-e3fc6f82.js";import{P as J}from"./PageHeader-80806eff.js";import{s as Q}from"./request-811deccb.js";import{g as W}from"./permission-c6efb21f.js";import{f as B}from"./format-42e477fa.js";import{h as ee}from"./errorHandler-e80e1e70.js";import{_ as ae}from"./index-4bf8c7f1.js";const le={class:"tenant-container"},te={class:"filter-section"},ne={class:"tenant-list-container"},de={class:"tenant-list-header"},ue={class:"tenant-list-item"},se={class:"tenant-info"},ie={class:"tenant-meta"},oe={class:"pagination-container-left"},re={key:0},me={class:"tenant-detail-header"},ve={class:"tenant-meta"},pe={class:"header-actions"},ce={class:"permission-template-section"},fe={class:"section-header"},ye={class:"dialog-footer"},he={class:"dialog-footer"},ge={key:0},be={class:"dialog-footer"},_e=ae(e({__name:"Index",setup(e){r();const ae=a(!1),_e=a([]),we=a(0),Te=a(1),Ce=a(10),Ve=a("all"),Ie=a(null),xe=a(null),Ue=l({keyword:"",dataIsolationMode:""}),ke=a(!1),Ne=a(!1),Me=a(),Ae=l({id:void 0,tenantName:"",tenantCode:"",tenantType:2,dataIsolationMode:1,adminUserId:null,adminUserDisplay:"",tenantPhone:"",tenantEmail:"",expireTime:null,tenantAddress:""}),Pe=a(!1),De=a([]),Ee=l({tenantName:[{required:!0,message:"请输入租户名称",trigger:"blur"}],tenantCode:[{required:!0,message:"请输入租户编码",trigger:"blur"},{pattern:/^[A-Za-z0-9_]+$/,message:"只能包含字母、数字和下划线",trigger:"blur"}],tenantType:[{required:!0,message:"请选择租户类型",trigger:"change"}],dataIsolationMode:[{required:!0,message:"请选择数据隔离模式",trigger:"change"}],adminUserId:[{required:!0,message:"请选择或输入管理员账号",trigger:"change"}],expireTime:[{required:!0,message:"请选择有效期",trigger:"change"}],tenantAddress:[{required:!1,message:"请输入地址",trigger:"blur"}]}),$e=a([]),Se=a(!1),ze=a([]),je=a(),qe=a([]),He=a(""),Le=a(null),Ye=a(1),Re=a(!1),Fe=a(null),Ke=e=>2===e.templateType||e.templateCode&&(e.templateCode.startsWith("ENT_")||e.templateCode.includes("企业"))||e.templateName&&e.templateName.includes("企业"),Oe=t((()=>{var e;return 2===(null==(e=xe.value)?void 0:e.tenantType)&&$e.value.some(Ke)})),Ge=t((()=>{var e;let a=ze.value.filter((e=>"已启用"===e.status));if(2===(null==(e=xe.value)?void 0:e.tenantType)&&Oe.value&&(a=a.filter((e=>!Ke(e)||$e.value.some((a=>a.id===e.id&&Ke(a)))))),!He.value)return a;const l=He.value.toLowerCase();return a.filter((e=>e.templateName.toLowerCase().includes(l)||e.templateCode.toLowerCase().includes(l)))})),Xe=e=>{var a;if(2===(null==(a=xe.value)?void 0:a.tenantType)){if(Oe.value&&!$e.value.some((a=>a.id===e.id&&Ke(a)))&&Ke(e))return!1;if(qe.value.length>0&&qe.value.some(Ke)&&Oe.value&&!$e.value.some((a=>a.id===e.id&&Ke(a)))&&Ke(e)&&!qe.value.find((a=>a.id===e.id&&Ke(a))))return!1;if(Ke(e)&&qe.value.some((a=>a.id!==e.id&&Ke(a))))return!1}return!0},Ze=e=>e.getTime()<Date.now()-864e5,Je=async()=>{ae.value=!0,xe.value=null,Ie.value=null;try{let e;"platform"===Ve.value?e=1:"enterprise"===Ve.value?e=2:"agent"===Ve.value&&(e=3);const a={tenantType:e,tenantName:Ue.keyword||void 0,tenantCode:Ue.keyword||void 0,dataIsolationMode:Ue.dataIsolationMode||void 0,pageNum:Te.value,pageSize:Ce.value},l=await function(e){return Q({url:"/tenant/api/tenant/tenants/page",method:"post",data:e})}(a);console.log("获取租户列表API返回:",l);let t=l;l&&200===l.code&&l.data&&(t=l.data),t&&t.records?(_e.value=t.records,we.value=t.total||0):Array.isArray(t)?(_e.value=t,we.value=t.length):(console.warn("无法识别的租户列表响应格式:",t),_e.value=[],we.value=0)}catch(e){ee(e,"获取租户列表失败"),_e.value=[],we.value=0}finally{ae.value=!1}},Qe=async e=>{try{const a=await function(e){return Q({url:`/tenant/api/tenant/tenants/${e}`,method:"get"})}(e);let l;console.log("获取租户详情API返回:",a),l=a&&200===a.code&&a.data?a.data:a,l?(xe.value={...l,adminAccount:l.adminUsername||"",phone:l.tenantPhone||"",tenantAddress:l.tenantAddress||""},We(e)):xe.value=null}catch(a){ee(a,"获取租户详情失败"),xe.value=null}},We=async e=>{try{const a=await function(e){return Q({url:`/tenant/api/tenant/tenants/${e}/templates`,method:"get"})}(e);let l;console.log("获取已绑定模板API返回:",a),l=a&&200===a.code&&a.data?a.data:a,l&&Array.isArray(l)?$e.value=l.map((e=>({...e,status:"已启用",moduleCount:e.moduleCount||0}))):$e.value=[]}catch(a){ee(a,"获取已绑定模板失败"),$e.value=[]}},Be=async()=>{try{const e={pageNum:1,pageSize:100,templateType:xe.value?xe.value.tenantType:void 0,templateName:He.value||void 0},a=await W(e);console.log("获取可用模板列表API返回:",a);let l={};l=a&&200===a.code&&a.data?a.data:a,l&&l.records?ze.value=l.records.map((e=>({...e,status:1===e.isSystem?"已启用":"未启用"}))):ze.value=[]}catch(e){ee(e,"获取可用模板列表失败"),ze.value=[]}},ea=e=>{Te.value=1,Je()},aa=e=>{Ie.value!==e.id&&(Ie.value=e.id,Qe(e.id))},la=e=>{Te.value=e,Je()},ta=()=>{da(),Ne.value=!1,ke.value=!0},na=async e=>{if(e)try{await function(e){return Q({url:`/tenant/api/tenant/tenants/${e}`,method:"delete"})}(e),O.success("租户删除成功"),Ie.value===e&&(Ie.value=null,xe.value=null),Je()}catch(a){ee(a,"删除租户失败")}},da=()=>{Ae.id=void 0,Ae.tenantName="",Ae.tenantCode="",Ae.tenantType=2,Ae.dataIsolationMode=1,Ae.adminUserId=null,Ae.adminUserDisplay="",Ae.tenantPhone="",Ae.tenantEmail="",Ae.expireTime=null,Ae.tenantAddress="",De.value=[],Me.value&&Me.value.resetFields()},ua=async()=>{Me.value&&await Me.value.validate((async e=>{if(e)try{const e={id:Ae.id,tenantName:Ae.tenantName,tenantCode:Ae.tenantCode,tenantType:Ae.tenantType,dataIsolationMode:Ae.dataIsolationMode,adminUserId:Ae.adminUserId,tenantPhone:Ae.tenantPhone,tenantEmail:Ae.tenantEmail,expireTime:Ae.expireTime?Ae.expireTime.getTime():void 0,tenantAddress:Ae.tenantAddress};if(void 0===e.expireTime&&delete e.expireTime,Ne.value&&e.id)await function(e,a){const l={...a,id:e};return Q({url:"/tenant/api/tenant/tenants",method:"put",data:l})}(e.id,e),O.success("租户更新成功"),Ie.value===e.id&&Qe(e.id);else{const l=await(a=e,Q({url:"/tenant/api/tenant/tenants",method:"post",data:a}));O.success("租户创建成功"),l&&l.id&&(Ie.value=l.id,Qe(l.id))}ke.value=!1,Je()}catch(l){ee(l,"保存租户失败，请检查输入或联系管理员")}var a}))},sa=()=>{if(xe.value){if(2===xe.value.tenantType){if($e.value.some((e=>Ke(e))))return void O.warning("企业商户只能绑定一个企业模板，请先解绑现有的企业模板。")}He.value="",qe.value=[],Le.value=new Date,Ye.value=1,Be(),Se.value=!0,je.value&&je.value.clearSelection()}},ia=async e=>{if(!xe.value)return;const a=e.templateId||e.id;console.log("解绑模板，使用templateId:",a,"模板数据:",e);try{await function(e,a){return Q({url:`/tenant/api/tenant/tenants/${e}/template/${a}`,method:"delete"})}(xe.value.id,a),O.success("模板解绑成功"),We(xe.value.id)}catch(l){ee(l,"解绑模板失败")}},oa=e=>{var a;if(2===(null==(a=xe.value)?void 0:a.tenantType)){const a=e.filter(Ke);if(a.length>1){O.warning("企业商户只能选择一个企业模板进行绑定。");const l=a[0];return qe.value=e.filter((e=>!Ke(e)||e.id===l.id)),void(je.value&&(je.value.clearSelection(),qe.value.forEach((e=>{je.value.toggleRowSelection(e,!0)}))))}}qe.value=e},ra=async()=>{if(!xe.value||0===qe.value.length)return;const e=xe.value.id;if(2===xe.value.tenantType){const e=qe.value.filter((e=>Ke(e)));if(e.length>1)return void ee(new Error("企业商户一次只能绑定一个企业模板"),"企业商户一次只能绑定一个企业模板");const a=$e.value.filter((e=>Ke(e)));if(a.length>0&&e.length>0){const l=a.map((e=>e.templateId||e.id));if(e.map((e=>e.id)).some((e=>!l.includes(e))))return void ee(new Error("该企业租户已绑定一个企业模板，请先解绑现有企业模板"),"该企业租户已绑定一个企业模板，请先解绑现有企业模板")}}try{const l=qe.value.map((e=>({templateId:e.id,bindMode:Ye.value,effectiveTime:Le.value?Le.value.getTime():Date.now()})));await(a={tenantId:e,templates:l},Q({url:"/tenant/api/tenant/tenants/bind/templates",method:"post",data:a})),O.success(`成功绑定 ${qe.value.length} 个模板`),Se.value=!1,We(e)}catch(l){ee(l,"绑定模板失败")}var a},ma=e=>e?e>4e12?"永久":B(e,"YYYY-MM-DD HH:mm:ss"):"-",va=e=>1===e?"继承":2===e?"快照":"-",pa=e=>{const a=Date.now();return e.expireTime<a?"已过期":"正常"},ca=e=>{const a=Date.now();return e.expireTime<a?"danger":"success"},fa=e=>{const a=Date.now();return e.expireTime<a?"status-expired":"status-active"},ya=e=>{switch(e){case 1:return"平台管理租户";case 2:return"企业商户租户";case 3:return"代理所租户";default:return"未知类型"}},ha=e=>{switch(e){case 2:return"";case 3:return"warning";case 1:return"success";default:return"info"}},ga=e=>{switch(e){case 1:return"行级隔离";case 2:return"Schema隔离";case 3:return"独立库";default:return"未知模式"}},ba=async e=>{if(e){Pe.value=!0;try{De.value=await(a=e,Q({url:"/ums/api/user/users/page",method:"post",data:{keyword:a,pageNum:1,pageSize:10}}).then((e=>e&&e.records?e.records.map((e=>({id:e.id,username:e.userName||e.loginName,email:e.userMail||""}))):[])))}catch(l){console.error("Failed to search users:",l),De.value=[]}finally{Pe.value=!1}}else De.value=[];var a},_a=e=>{if(e){const a=De.value.find((a=>a.id===e));a&&(Ae.adminUserDisplay=`${a.username} (${a.email})`)}else Ae.adminUserDisplay=""},wa=()=>{Be()};return n((()=>{Je()})),d([()=>Ue.keyword,()=>Ue.dataIsolationMode],(()=>{Te.value=1,Je()})),d(xe,((e,a)=>{Se.value||(null==e?void 0:e.id)===(null==a?void 0:a.id)||(Le.value=null,Ye.value=1,qe.value=[])})),d(Se,(e=>{e||(Le.value=null,Ye.value=1,qe.value=[],je.value&&je.value.clearSelection()),!e&&Fe.value&&(Fe.value=null)})),(e,a)=>{const l=G,t=X,n=Z;return m(),u("div",le,[s(J,{title:"租户管理中心",subtitle:"管理平台中的所有租户及其权限模板"}),s(o(L),{gutter:20},{default:i((()=>[s(o(T),{xs:24,sm:10,md:8,class:"responsive-col"},{default:i((()=>[s(o(C),{class:"left-panel"},{default:i((()=>[s(o(V),{modelValue:Ve.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Ve.value=e),onTabClick:ea},{default:i((()=>[s(o(I),{label:"全部租户",name:"all"}),s(o(I),{label:"平台超级租户",name:"platform"}),s(o(I),{label:"企业商户端",name:"enterprise"}),s(o(I),{label:"代理所客户端",name:"agent"})])),_:1},8,["modelValue"]),v("div",te,[s(o(x),{modelValue:Ue.dataIsolationMode,"onUpdate:modelValue":a[1]||(a[1]=e=>Ue.dataIsolationMode=e),placeholder:"数据隔离模式",clearable:"",style:{width:"48%","margin-bottom":"10px"}},{default:i((()=>[s(o(U),{label:"全部",value:""}),s(o(U),{label:"行级隔离",value:"1"}),s(o(U),{label:"Schema隔离",value:"2"}),s(o(U),{label:"独立库",value:"3"})])),_:1},8,["modelValue"]),s(o(k),{modelValue:Ue.keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>Ue.keyword=e),placeholder:"搜索租户名称或编码...",clearable:"",style:{width:"48%",float:"right","margin-bottom":"10px"}},{prefix:i((()=>[s(o(N),null,{default:i((()=>[s(o(M))])),_:1})])),_:1},8,["modelValue"]),s(o(A),{type:"primary",onClick:ta,style:{width:"100%"}},{default:i((()=>[s(o(N),null,{default:i((()=>[s(o(P))])),_:1}),a[22]||(a[22]=p(" 新增租户 "))])),_:1})]),v("div",ne,[v("div",de,[a[23]||(a[23]=v("h3",null,"租户列表",-1)),v("span",null,"显示 "+c((Te.value-1)*Ce.value+1)+" 到 "+c(Math.min(Te.value*Ce.value,we.value))+"，共 "+c(we.value)+" 条",1)]),f((m(),y(o($),{data:_e.value,"highlight-current-row":"",onRowClick:aa,style:{width:"100%"},height:"calc(100vh - 450px)"},{default:i((()=>[s(o(D),{prop:"tenantName",label:"租户名称"},{default:i((({row:e})=>[v("div",ue,[v("div",se,[v("span",{class:h(["tenant-status",fa(e)])},null,2),v("span",null,c(e.tenantName),1),s(o(E),{size:"small",type:ha(e.tenantType),style:{"margin-left":"8px"}},{default:i((()=>[p(c(ya(e.tenantType).substring(0,2)),1)])),_:2},1032,["type"])]),v("div",ie,[v("span",null,"编码: "+c(e.tenantCode)+" | 创建: "+c(ma(e.createTime))+" | 有效期: "+c(ma(e.expireTime)),1)])])])),_:1})])),_:1},8,["data"])),[[n,ae.value]]),v("div",oe,[s(o(S),{small:"",layout:"prev, pager, next",total:we.value,"page-size":Ce.value,"current-page":Te.value,"onUpdate:currentPage":a[3]||(a[3]=e=>Te.value=e),onCurrentChange:la},null,8,["total","page-size","current-page"])])])])),_:1})])),_:1}),s(o(T),{span:16},{default:i((()=>[s(o(C),{class:"right-panel"},{default:i((()=>[xe.value?(m(),u("div",re,[v("div",me,[v("h2",null,[p(c(xe.value.tenantName)+" ",1),s(o(E),{type:ca(xe.value),size:"small",style:{"margin-left":"10px"}},{default:i((()=>[p(c(pa(xe.value)),1)])),_:1},8,["type"])]),v("div",ve,[v("span",null,"创建于 "+c(ma(xe.value.createTime))+"，有效期至 "+c(ma(xe.value.expireTime)),1)]),v("div",pe,[s(o(A),{type:"primary",onClick:a[4]||(a[4]=e=>(e=>{if(!e)return;const a=xe.value;a?(da(),Ne.value=!0,ke.value=!0,Object.assign(Ae,{id:a.id,tenantName:a.tenantName,tenantCode:a.tenantCode,tenantType:a.tenantType,dataIsolationMode:a.dataIsolationMode,adminUserId:a.adminUserId||null,tenantPhone:a.tenantPhone||"",tenantEmail:a.tenantEmail||"",expireTime:a.expireTime?new Date(a.expireTime):null,tenantAddress:a.tenantAddress||""}),a.adminUserId&&a.adminUsername&&(De.value=[{id:a.adminUserId,username:a.adminUsername,email:""}],Ae.adminUserDisplay=a.adminUsername)):O.warning("未找到租户信息")})(xe.value.id))},{default:i((()=>a[24]||(a[24]=[p("编辑")]))),_:1}),s(o(z),{title:"确定要删除该租户吗?",onConfirm:a[5]||(a[5]=e=>na(xe.value.id))},{reference:i((()=>[s(o(A),{type:"danger"},{default:i((()=>a[25]||(a[25]=[p("删除")]))),_:1})])),_:1})])]),s(o(j),{title:"基本信息",column:2,border:"",class:"description-section"},{default:i((()=>[s(o(q),{label:"租户编码"},{default:i((()=>[p(c(xe.value.tenantCode),1)])),_:1}),s(o(q),{label:"租户类型"},{default:i((()=>[p(c(ya(xe.value.tenantType)),1)])),_:1}),s(o(q),{label:"数据隔离模式"},{default:i((()=>[p(c(ga(xe.value.dataIsolationMode)),1)])),_:1}),s(o(q),{label:"管理员"},{default:i((()=>[p(c(xe.value.adminUsername||(xe.value.adminUserId?`User ID: ${xe.value.adminUserId}`:"-")),1)])),_:1}),s(o(q),{label:"联系电话"},{default:i((()=>[p(c(xe.value.tenantPhone||"-"),1)])),_:1}),s(o(q),{label:"联系邮箱"},{default:i((()=>[p(c(xe.value.tenantEmail||"-"),1)])),_:1}),s(o(q),{label:"地址",span:2},{default:i((()=>[p(c(xe.value.tenantAddress||"-"),1)])),_:1})])),_:1}),v("div",ce,[v("div",fe,[a[27]||(a[27]=v("h3",null,"企业模板绑定",-1)),s(o(A),{type:"primary",onClick:sa,disabled:!xe.value||0===xe.value.tenantType&&Oe.value},{default:i((()=>[s(o(N),null,{default:i((()=>[s(o(P))])),_:1}),a[26]||(a[26]=p(" 绑定企业模板 "))])),_:1},8,["disabled"])]),s(o($),{data:$e.value,stripe:"",style:{width:"100%"}},{default:i((()=>[s(o(D),{prop:"templateName",label:"模板名称"}),s(o(D),{prop:"templateCode",label:"模板编码"}),s(o(D),{prop:"moduleCount",label:"模块数量"}),s(o(D),{label:"绑定时间"},{default:i((({row:e})=>[p(c(ma(e.bindTime||e.createTime)),1)])),_:1}),s(o(D),{label:"生效时间"},{default:i((({row:e})=>[p(c(ma(e.effectiveTime)),1)])),_:1}),s(o(D),{label:"绑定模式"},{default:i((({row:e})=>[p(c(va(e.bindMode)),1)])),_:1}),s(o(D),{label:"状态"},{default:i((({row:e})=>[s(o(E),{type:"已启用"===e.status?"success":"info"},{default:i((()=>[p(c(e.status),1)])),_:2},1032,["type"])])),_:1}),s(o(D),{label:"操作",width:"150"},{default:i((({row:e})=>[s(o(A),{text:"",type:"primary",size:"small",onClick:a=>(e=>{const a=$e.value.find((a=>(a.templateId||a.id)===e));if(a)Fe.value={...a},Re.value=!0;else{const a=ze.value.find((a=>a.id===e));a?(Fe.value={...a},Re.value=!0):ee(new Error("未找到模板信息"),"未找到模板信息")}})(e.templateId||e.id)},{default:i((()=>a[28]||(a[28]=[p("查看")]))),_:2},1032,["onClick"]),s(o(z),{title:"确定要解绑该模板吗?",onConfirm:a=>ia(e)},{reference:i((()=>[s(o(A),{text:"",type:"danger",size:"small",disabled:"未启用"===e.status},{default:i((()=>a[29]||(a[29]=[p(" 解绑 ")]))),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])])])):(m(),y(o(H),{key:1,description:"请在左侧选择一个租户查看详情"}))])),_:1})])),_:1})])),_:1}),s(o(K),{modelValue:ke.value,"onUpdate:modelValue":a[14]||(a[14]=e=>ke.value=e),title:Ne.value?"编辑租户":"新增租户",width:"600px"},{footer:i((()=>[v("span",ye,[s(o(A),{onClick:a[13]||(a[13]=e=>ke.value=!1)},{default:i((()=>a[30]||(a[30]=[p("取消")]))),_:1}),s(o(A),{type:"primary",onClick:ua},{default:i((()=>a[31]||(a[31]=[p("确认")]))),_:1})])])),default:i((()=>[s(o(Y),{ref_key:"tenantFormRef",ref:Me,model:Ae,rules:Ee,"label-width":"120px"},{default:i((()=>[s(o(R),{label:"租户名称",prop:"tenantName"},{default:i((()=>[s(o(k),{modelValue:Ae.tenantName,"onUpdate:modelValue":a[6]||(a[6]=e=>Ae.tenantName=e),placeholder:"请输入租户名称"},null,8,["modelValue"])])),_:1}),s(o(R),{label:"租户编码",prop:"tenantCode"},{default:i((()=>[s(o(k),{modelValue:Ae.tenantCode,"onUpdate:modelValue":a[7]||(a[7]=e=>Ae.tenantCode=e),placeholder:"请输入租户编码",disabled:Ne.value},null,8,["modelValue","disabled"])])),_:1}),s(o(R),{label:"租户类型",prop:"tenantType"},{default:i((()=>[s(o(x),{modelValue:Ae.tenantType,"onUpdate:modelValue":a[8]||(a[8]=e=>Ae.tenantType=e),placeholder:"请选择租户类型",style:{width:"100%"}},{default:i((()=>[s(o(U),{label:"企业商户端",value:0}),s(o(U),{label:"代理所客户端",value:1}),s(o(U),{label:"平台超级租户",value:2})])),_:1},8,["modelValue"])])),_:1}),s(o(R),{label:"数据隔离模式",prop:"dataIsolationMode"},{default:i((()=>[s(o(x),{modelValue:Ae.dataIsolationMode,"onUpdate:modelValue":a[9]||(a[9]=e=>Ae.dataIsolationMode=e),placeholder:"请选择数据隔离模式",style:{width:"100%"}},{default:i((()=>[s(o(U),{label:"行级隔离",value:1}),s(o(U),{label:"Schema隔离",value:2}),s(o(U),{label:"独立库",value:3})])),_:1},8,["modelValue"])])),_:1}),s(o(R),{label:"管理员账号",prop:"adminUserId"},{default:i((()=>[s(o(x),{modelValue:Ae.adminUserId,"onUpdate:modelValue":a[10]||(a[10]=e=>Ae.adminUserId=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"输入用户名或邮箱搜索","remote-method":ba,loading:Pe.value,clearable:"",style:{width:"100%"},onChange:_a},{default:i((()=>[(m(!0),u(g,null,b(De.value,(e=>(m(),y(o(U),{key:e.id,label:`${e.username} (${e.email})`,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),s(o(R),{label:"服务有效期至",prop:"expireTime"},{default:i((()=>[s(o(F),{modelValue:Ae.expireTime,"onUpdate:modelValue":a[11]||(a[11]=e=>Ae.expireTime=e),type:"date",placeholder:"选择有效期",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),s(o(R),{label:"地址",prop:"tenantAddress"},{default:i((()=>[s(o(k),{modelValue:Ae.tenantAddress,"onUpdate:modelValue":a[12]||(a[12]=e=>Ae.tenantAddress=e),placeholder:"请输入地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),s(o(K),{modelValue:Se.value,"onUpdate:modelValue":a[19]||(a[19]=e=>Se.value=e),title:"绑定企业模板",width:"800px"},{footer:i((()=>[v("span",he,[s(o(A),{onClick:a[18]||(a[18]=e=>Se.value=!1)},{default:i((()=>a[37]||(a[37]=[p("取消")]))),_:1}),s(o(A),{type:"primary",onClick:ra,disabled:0===qe.value.length},{default:i((()=>a[38]||(a[38]=[p("确认绑定")]))),_:1},8,["disabled"])])])),default:i((()=>{var e;return[v("p",null,[a[32]||(a[32]=p("选择要绑定到 ")),v("strong",null,c(null==(e=xe.value)?void 0:e.tenantName),1),a[33]||(a[33]=p(" 的企业模板："))]),s(o(k),{modelValue:He.value,"onUpdate:modelValue":a[15]||(a[15]=e=>He.value=e),placeholder:"搜索模板名称或编码...",clearable:"",style:{"margin-bottom":"15px"},onKeyup:_(wa,["enter"]),onClear:Be},{prefix:i((()=>[s(o(N),null,{default:i((()=>[s(o(M))])),_:1})])),append:i((()=>[s(o(A),{onClick:wa},{default:i((()=>a[34]||(a[34]=[p("搜索")]))),_:1})])),_:1},8,["modelValue"]),s(o($),{data:Ge.value,ref_key:"availableTemplatesTableRef",ref:je,onSelectionChange:oa,"max-height":"300px"},{default:i((()=>[s(o(D),{type:"selection",width:"55",selectable:Xe}),s(o(D),{prop:"templateName",label:"模板名称"}),s(o(D),{prop:"templateCode",label:"模板编码"}),s(o(D),{prop:"moduleCount",label:"模块数量"}),s(o(D),{label:"创建时间"},{default:i((({row:e})=>[p(c(ma(e.createTime)),1)])),_:1}),s(o(D),{label:"状态"},{default:i((({row:e})=>[s(o(E),{type:"已启用"===e.status?"success":"info"},{default:i((()=>[p(c(e.status),1)])),_:2},1032,["type"])])),_:1})])),_:1},8,["data"]),s(o(Y),{"label-width":"100px",style:{"margin-top":"20px"},disabled:0===qe.value.length},{default:i((()=>[s(o(R),{label:"生效时间",prop:"bindEffectiveTime"},{default:i((()=>[s(o(F),{modelValue:Le.value,"onUpdate:modelValue":a[16]||(a[16]=e=>Le.value=e),type:"datetime",placeholder:"选择生效时间",style:{width:"100%"},"disabled-date":Ze},null,8,["modelValue"])])),_:1}),s(o(R),{label:"绑定模式",prop:"bindMode"},{default:i((()=>[s(t,{modelValue:Ye.value,"onUpdate:modelValue":a[17]||(a[17]=e=>Ye.value=e)},{default:i((()=>[s(l,{value:1},{default:i((()=>a[35]||(a[35]=[p("继承")]))),_:1}),s(l,{value:2},{default:i((()=>a[36]||(a[36]=[p("快照")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["disabled"])]})),_:1},8,["modelValue"]),s(o(K),{modelValue:Re.value,"onUpdate:modelValue":a[21]||(a[21]=e=>Re.value=e),title:"查看模板详情",width:"600px"},{footer:i((()=>[v("span",be,[s(o(A),{onClick:a[20]||(a[20]=e=>Re.value=!1)},{default:i((()=>a[39]||(a[39]=[p("关闭")]))),_:1})])])),default:i((()=>[Fe.value?(m(),u("div",ge,[s(o(j),{column:1,border:""},{default:i((()=>{return[s(o(q),{label:"模板名称"},{default:i((()=>[p(c(Fe.value.templateName),1)])),_:1}),s(o(q),{label:"模板编码"},{default:i((()=>[p(c(Fe.value.templateCode),1)])),_:1}),s(o(q),{label:"模块数量"},{default:i((()=>[p(c(Fe.value.moduleCount),1)])),_:1}),s(o(q),{label:"创建时间"},{default:i((()=>[p(c(ma(Fe.value.createTime)),1)])),_:1}),s(o(q),{label:"状态"},{default:i((()=>[s(o(E),{type:"已启用"===Fe.value.status?"success":"info"},{default:i((()=>[p(c(Fe.value.status),1)])),_:1},8,["type"])])),_:1}),(e=Fe.value,e&&void 0!==e.bindTime?(m(),u(g,{key:0},[s(o(q),{label:"绑定时间"},{default:i((()=>[p(c(ma(Fe.value.bindTime)),1)])),_:1}),s(o(q),{label:"生效时间"},{default:i((()=>[p(c(ma(Fe.value.effectiveTime)),1)])),_:1}),s(o(q),{label:"绑定模式"},{default:i((()=>[p(c(va(Fe.value.bindMode)),1)])),_:1})],64)):w("",!0))];var e})),_:1})])):(m(),y(o(H),{key:1,description:"没有可显示的模板信息"}))])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-26d14617"]]);export{_e as default};
