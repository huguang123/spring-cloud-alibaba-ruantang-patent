import{x as e,r as l,X as a,z as s,P as r,H as o,ax as t,y as d,A as u,u as n,L as i}from"./vue-4e979bb7.js";import{O as c,l as m,T as p,E as w,v as f,V as g,a3 as b,w as v,b as h,a6 as _,ai as y,G as P,X as V,K as x,L as T}from"./elementPlus-e3fc6f82.js";import{u as q,_ as U}from"./index-4bf8c7f1.js";import{c as j,d as k}from"./auth-ef5ad292.js";import"./request-811deccb.js";const E={class:"settings-container"},A=U(e({__name:"Settings",setup(e){const U=t(),A=q(),C=l(!1),F=l(!1),L=l(),B=l(),H=a({oldPassword:"",newPassword:"",confirmPassword:""}),R=a({currentPassword:"",reason:"",confirmText:""}),S=a({oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"新密码长度不能少于6位",trigger:"blur"},{validator:(e,l,a)=>{l===H.oldPassword?a(new Error("新密码不能与当前密码相同")):a()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(e,l,a)=>{l!==H.newPassword?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}]}),X=a({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],reason:[{required:!0,message:"请选择注销原因",trigger:"change"}],confirmText:[{required:!0,message:"请输入确认文本",trigger:"blur"},{validator:(e,l,a)=>{"确认注销"!==l?a(new Error('请准确输入"确认注销"')):a()},trigger:"blur"}]}),z=async()=>{L.value&&await L.value.validate((async e=>{var l;if(e){C.value=!0;try{const e=await j(H);console.log("修改密码响应:",e),200===e.code?(w.success("密码修改成功，请重新登录"),null==(l=L.value)||l.resetFields(),setTimeout((()=>{A.logoutAction(),U.push("/login")}),2e3)):w.error(e.message||"密码修改失败")}catch(a){console.error("修改密码失败:",a),w.error("修改密码失败")}finally{C.value=!1}}}))},G=async()=>{await f.confirm("您确定要注销账户吗？此操作无法撤销，所有数据将被永久删除！","确认注销账户",{confirmButtonText:"确定注销",cancelButtonText:"取消",type:"error",dangerouslyUseHTMLString:!0,customClass:"deactivate-confirm-dialog"}).then((()=>{I()})).catch((()=>{w.info("已取消注销操作")}))},I=async()=>{B.value&&await B.value.validate((async e=>{if(e){F.value=!0;try{const e=await k(R);console.log("账户注销响应:",e),200===e.code?(w.success("账户注销成功"),A.logoutAction(),U.push("/login")):w.error(e.message||"账户注销失败")}catch(l){console.error("账户注销失败:",l),w.error("账户注销失败")}finally{F.value=!1}}}))};return(e,l)=>{const a=g,t=b,w=v,f=h,q=_,U=y,j=P,k=V,A=x,I=T,K=c;return d(),s("div",E,[r(K,{gutter:20},{default:o((()=>[r(k,{span:12},{default:o((()=>[r(j,{class:"settings-card"},{header:o((()=>l[6]||(l[6]=[u("div",{class:"card-header"},[u("h3",null,"修改密码"),u("p",{class:"subtitle"},"定期更新密码以保护账户安全")],-1)]))),default:o((()=>[r(q,{ref_key:"passwordFormRef",ref:L,model:H,rules:S,"label-width":"120px",class:"password-form"},{default:o((()=>[r(t,{label:"当前密码",prop:"oldPassword"},{default:o((()=>[r(a,{modelValue:H.oldPassword,"onUpdate:modelValue":l[0]||(l[0]=e=>H.oldPassword=e),type:"password",placeholder:"请输入当前密码","show-password":"",autocomplete:"current-password"},null,8,["modelValue"])])),_:1}),r(t,{label:"新密码",prop:"newPassword"},{default:o((()=>[r(a,{modelValue:H.newPassword,"onUpdate:modelValue":l[1]||(l[1]=e=>H.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])])),_:1}),r(t,{label:"确认新密码",prop:"confirmPassword"},{default:o((()=>[r(a,{modelValue:H.confirmPassword,"onUpdate:modelValue":l[2]||(l[2]=e=>H.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])])),_:1}),r(t,null,{default:o((()=>[r(f,{type:"primary",onClick:z,loading:C.value,class:"full-width-btn"},{default:o((()=>[r(w,null,{default:o((()=>[r(n(m))])),_:1}),l[7]||(l[7]=i(" 修改密码 "))])),_:1},8,["loading"])])),_:1})])),_:1},8,["model","rules"]),r(U,{title:"密码安全提示",type:"info",closable:!1,class:"security-tips"},{default:o((()=>l[8]||(l[8]=[u("ul",null,[u("li",null,"密码长度至少6位字符"),u("li",null,"建议包含字母、数字和特殊字符"),u("li",null,"不要使用容易被猜到的密码"),u("li",null,"定期更换密码保护账户安全")],-1)]))),_:1})])),_:1})])),_:1}),r(k,{span:12},{default:o((()=>[r(j,{class:"settings-card danger-card"},{header:o((()=>l[9]||(l[9]=[u("div",{class:"card-header"},[u("h3",null,"账户注销"),u("p",{class:"subtitle"},"永久删除您的账户和所有相关数据")],-1)]))),default:o((()=>[r(U,{title:"危险操作警告",type:"error",closable:!1,class:"danger-alert"},{default:o((()=>l[10]||(l[10]=[u("p",null,"账户注销后将无法恢复，请谨慎操作！",-1),u("ul",null,[u("li",null,"所有个人数据将被永久删除"),u("li",null,"无法找回任何历史记录"),u("li",null,"相关权限将被立即撤销")],-1)]))),_:1}),r(q,{ref_key:"deactivateFormRef",ref:B,model:R,rules:X,"label-width":"120px",class:"deactivate-form"},{default:o((()=>[r(t,{label:"当前密码",prop:"currentPassword"},{default:o((()=>[r(a,{modelValue:R.currentPassword,"onUpdate:modelValue":l[3]||(l[3]=e=>R.currentPassword=e),type:"password",placeholder:"请输入当前密码确认身份","show-password":""},null,8,["modelValue"])])),_:1}),r(t,{label:"注销原因",prop:"reason"},{default:o((()=>[r(I,{modelValue:R.reason,"onUpdate:modelValue":l[4]||(l[4]=e=>R.reason=e),placeholder:"请选择注销原因",style:{width:"100%"}},{default:o((()=>[r(A,{label:"不再需要此账户",value:"不再需要此账户"}),r(A,{label:"切换到其他账户",value:"切换到其他账户"}),r(A,{label:"隐私考虑",value:"隐私考虑"}),r(A,{label:"功能不满足需求",value:"功能不满足需求"}),r(A,{label:"其他原因",value:"其他原因"})])),_:1},8,["modelValue"])])),_:1}),r(t,{label:"确认注销",prop:"confirmText"},{default:o((()=>[r(a,{modelValue:R.confirmText,"onUpdate:modelValue":l[5]||(l[5]=e=>R.confirmText=e),placeholder:"请输入 '确认注销' 以继续"},null,8,["modelValue"]),l[11]||(l[11]=u("div",{class:"confirm-hint"},[i(" 请准确输入 "),u("code",null,"确认注销"),i(" 以确认此操作 ")],-1))])),_:1}),r(t,null,{default:o((()=>[r(f,{type:"danger",onClick:G,loading:F.value,class:"full-width-btn",disabled:"确认注销"!==R.confirmText},{default:o((()=>[r(w,null,{default:o((()=>[r(n(p))])),_:1}),l[12]||(l[12]=i(" 注销账户 "))])),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-b95e5f06"]]);export{A as default};
