import{x as e,r as a,X as l,h as o,k as r,n as t,z as d,P as s,H as n,y as i,u,L as m,A as p,G as c,M as g,V as v,K as h,O as f,I as y,a4 as I,a5 as N}from"./vue-4e979bb7.js";import{E as b,O as _,P as C,Q as w,o as V,R as k,S as T,T as D,U as x,v as P,w as S,b as U,V as j,W as z,G as A,X as M,Y as R,Z as $,H as O,_ as B,$ as L,a0 as H,a1 as q,a2 as J,a3 as F,a4 as K,a5 as Y,J as X,a6 as E,a7 as G,K as Q,L as Z,a8 as W,a9 as ee}from"./elementPlus-e3fc6f82.js";import{f as ae}from"./format-42e477fa.js";import{P as le}from"./PageHeader-80806eff.js";import{s as oe}from"./request-811deccb.js";import{g as re,_ as te}from"./index-4bf8c7f1.js";import{h as de}from"./errorHandler-e80e1e70.js";function se(){const e=re();return e||console.warn("警告: 租户ID为空，请确保已正确登录并获取用户信息"),e}const ne=[{id:1,orgName:"总公司",parentId:0,tenantId:1,orgCode:"HQ",orgPath:".1.",state:1,createTime:16725024e5,updateTime:16725024e5,staffCount:5,children:[{id:2,orgName:"研发中心",parentId:1,tenantId:1,orgCode:"RD",orgPath:".1.2.",state:1,createTime:16725024e5,updateTime:16725024e5,staffCount:8,children:[]},{id:3,orgName:"市场部",parentId:1,tenantId:1,orgCode:"MKT",orgPath:".1.3.",state:1,createTime:16725024e5,updateTime:16725024e5,staffCount:10,children:[]},{id:4,orgName:"人力资源部",parentId:1,tenantId:1,orgCode:"HR",orgPath:".1.4.",state:1,createTime:16725024e5,updateTime:16725024e5,staffCount:6,children:[]},{id:5,orgName:"财务部",parentId:1,tenantId:1,orgCode:"FN",orgPath:".1.5.",state:1,createTime:16725024e5,updateTime:16725024e5,staffCount:7,children:[]}]}],ie=[{id:1,rolesCode:"admin",rolesName:"管理员",rolesType:0},{id:2,rolesCode:"manager",rolesName:"经理",rolesType:1},{id:3,rolesCode:"supervisor",rolesName:"主管",rolesType:1},{id:4,rolesCode:"staff",rolesName:"专员",rolesType:1}],ue=[{id:101,username:"employee1",realName:"员工1",email:"employee1@example.com",phone:"13812340000",roles:[{id:2,rolesCode:"manager",rolesName:"经理",rolesType:1}],entryDate:15778368e5,orgId:5},{id:102,username:"employee2",realName:"员工2",email:"employee2@example.com",phone:"13812340001",roles:[{id:3,rolesCode:"supervisor",rolesName:"主管",rolesType:1}],entryDate:15909696e5,orgId:5},{id:103,username:"employee3",realName:"员工3",email:"employee3@example.com",phone:"13812340002",roles:[{id:4,rolesCode:"staff",rolesName:"专员",rolesType:1}],entryDate:15868224e5,orgId:5},{id:104,username:"employee4",realName:"员工4",email:"employee4@example.com",phone:"13812340003",roles:[{id:2,rolesCode:"manager",rolesName:"经理",rolesType:1}],entryDate:15876e8,orgId:5},{id:105,username:"employee5",realName:"员工5",email:"employee5@example.com",phone:"13812340004",roles:[{id:4,rolesCode:"staff",rolesName:"专员",rolesType:1}],entryDate:15843168e5,orgId:5},{id:106,username:"employee6",realName:"员工6",email:"employee6@example.com",phone:"13812340005",roles:[{id:3,rolesCode:"supervisor",rolesName:"主管",rolesType:1}],entryDate:159192e7,orgId:5},{id:107,username:"employee7",realName:"员工7",email:"employee7@example.com",phone:"13812340006",roles:[{id:4,rolesCode:"staff",rolesName:"专员",rolesType:1}],entryDate:15920064e5,orgId:5}];const me={class:"org-container"},pe={class:"card-header"},ce={class:"tree-wrapper"},ge={class:"custom-tree-node"},ve={class:"tree-node-label"},he={class:"tree-node-count"},fe={class:"tree-node-actions"},ye={key:0,class:"empty-state"},Ie={class:"card-header"},Ne={class:"card-header"},be={class:"members-content"},_e={key:0},Ce={key:0,class:"pagination-container"},we={class:"dialog-footer"},Ve={key:0,class:"search-user-section"},ke={class:"dialog-footer"},Te=te(e({__name:"OrganizationTree",setup(e){const re=a([]),te=a(""),Te=a(),De=a(!1),xe=a({}),Pe=a(!1),Se=a(!1),Ue=a(),je=l({id:void 0,orgName:"",orgCode:"",parentId:void 0,tenantId:"",orgPhone:"",orgMail:"",state:1,description:""}),ze={orgName:[{required:!0,message:"请输入组织名称",trigger:"blur"},{max:50,message:"长度不能超过50个字符",trigger:"blur"}],orgCode:[{required:!0,message:"请输入组织编码",trigger:"blur"},{pattern:/^[A-Za-z0-9_]+$/,message:"只能包含字母、数字和下划线",trigger:"blur"},{max:30,message:"长度不能超过30个字符",trigger:"blur"}],parentId:[{required:!1,message:"请选择上级组织",trigger:"change"}],orgPhone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],orgMail:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},Ae=a([]),Me=a(!1),Re=a(1),$e=a(10),Oe=a(0),Be=a(!1),Le=a(!1),He=a(),qe=a({}),Je=l({id:void 0,userId:void 0,realName:"",username:"",email:"",phone:"",roleIds:[],entryDate:null,orgId:void 0}),Fe=a(""),Ke=a(!1),Ye=a([]),Xe=a([]),Ee={roleIds:[{type:"array",required:!0,message:"请至少选择一个角色",trigger:"change"}],entryDate:[{required:!0,message:"请选择入职日期",trigger:"change"}]},Ge=(e,a)=>!e||(a.orgName.includes(e)||a.orgCode.includes(e));o(te,(e=>{var a;null==(a=Te.value)||a.filter(e)}));const Qe=async()=>{De.value=!0;try{const e=await function(e){const a=e||se();return console.log("获取组织树，使用租户ID:",a),a?oe({url:"/org/api/org/organizations/tree",method:"get",params:{tenantId:a},paramsSerializer:e=>Object.keys(e).map((a=>`${encodeURIComponent(a)}=${encodeURIComponent(String(e[a]))}`)).join("&")}).catch((e=>(console.error("获取组织树失败:",e),console.log("使用模拟数据作为后备方案"),Promise.resolve({code:200,message:"success",data:ne})))):(console.error("错误: 获取组织树时租户ID为空"),Promise.reject(new Error("租户ID不能为空")))}();console.log("组织树API返回:",e),e&&200===e.code&&Array.isArray(e.data)?(re.value=e.data,console.log("获取组织树成功:",re.value)):(console.warn("获取组织树返回格式异常，使用模拟数据:",e),re.value=ne)}catch(e){de(e,"获取组织架构数据失败"),re.value=ne}finally{De.value=!1}},Ze=async()=>{try{const e=await function(e){const a=e||se();return console.log("获取角色列表，租户ID:",a),oe({url:`/tenant/api/tenant/tenants/${a}/roles`,method:"get"})}();e&&e.data?(Xe.value=e.data.map((e=>({id:e.roleId,rolesCode:e.rolesCode,rolesName:e.rolesName,rolesType:e.rolesType}))),console.log("获取角色列表成功:",Xe.value)):(console.warn("获取角色列表失败，使用模拟数据:",e),Xe.value=ie)}catch(e){de(e,"获取角色列表失败"),Xe.value=ie}},We=e=>{e.id!==xe.value.id&&(xe.value={...e},Re.value=1,Ae.value=[],ea(),aa())},ea=async()=>{var e;if(xe.value.id)try{console.log("开始加载组织详情，组织ID:",xe.value.id);const a=await(e=xe.value.id,oe({url:`/org/api/org/organizations/${e}`,method:"get"}));console.log("获取组织详情API返回:",a),a&&200===a.code&&a.data?(xe.value={...xe.value,...a.data,children:xe.value.children},console.log("获取组织详情成功:",xe.value)):console.warn("获取组织详情失败，保持当前数据:",a)}catch(a){console.error("获取组织详情失败",a),de(a,"获取组织详情失败")}},aa=async()=>{if(xe.value.id){Me.value=!0;try{const e=await function(e,a={}){return oe({url:"/org/api/org/members/page",method:"get",params:{...a,orgId:e,tenantId:a.tenantId||se()}})}(xe.value.id,{pageNum:Re.value,pageSize:$e.value});if(console.log("获取组织成员API返回:",e),e&&200===e.code&&e.data&&e.data.records)Ae.value=e.data.records.map((e=>{console.log("处理组织成员数据:",e);let a=[];if(e.roles&&Array.isArray(e.roles))e.roles.length>0&&"object"==typeof e.roles[0]?a=e.roles.map((e=>({id:e.roleId||e.id,rolesCode:e.rolesCode||"",rolesName:e.rolesName||"",rolesType:e.rolesType||1}))):e.roles.length>0&&"string"==typeof e.roles[0]&&(a=e.roleIds&&Array.isArray(e.roleIds)?e.roles.map(((a,l)=>({id:e.roleIds[l]||0,rolesCode:"",rolesName:a,rolesType:1}))):e.roles.map(((e,a)=>({id:a+1,rolesCode:"",rolesName:e,rolesType:1}))));else if(e.roles&&"string"==typeof e.roles)try{const l=JSON.parse(e.roles);Array.isArray(l)&&(l.length>0&&"object"==typeof l[0]?a=l.map((e=>({id:e.roleId||e.id,rolesCode:e.rolesCode||"",rolesName:e.rolesName||"",rolesType:e.rolesType||1}))):l.length>0&&"string"==typeof l[0]&&(a=e.roleIds&&Array.isArray(e.roleIds)?l.map(((a,l)=>({id:e.roleIds[l]||0,rolesCode:"",rolesName:a,rolesType:1}))):l.map(((e,a)=>({id:a+1,rolesCode:"",rolesName:e,rolesType:1})))))}catch(l){console.error("解析角色JSON失败:",l)}return console.log("处理后的角色数据:",a),{id:e.id,username:e.loginName||"",realName:e.userName||"",email:e.userMail||"",phone:e.userPhone||"",roleIds:e.roleIds||a.map((e=>e.id)),roles:a,entryDate:e.joinDate||Date.now(),orgId:xe.value.id}})),Oe.value=e.data.total||0,console.log("获取组织成员成功:",Ae.value);else{console.warn("获取组织成员失败，使用模拟数据:",e);let a=[];switch(xe.value.id){case 5:a=ue;break;case 2:a=ue.slice(0,4).map((e=>({...e,orgId:2,realName:e.realName.replace("员工","研发"),roles:[{id:4,rolesCode:"developer",rolesName:"开发工程师",rolesType:1}]})));break;case 3:a=ue.slice(0,3).map((e=>({...e,orgId:3,realName:e.realName.replace("员工","市场"),roles:[{id:3,rolesCode:"marketing",rolesName:"市场专员",rolesType:1}]})));break;case 4:a=ue.slice(0,2).map((e=>({...e,orgId:4,realName:e.realName.replace("员工","HR"),roles:[{id:2,rolesCode:"hr",rolesName:"人力资源",rolesType:1}]})));break;default:a=1===xe.value.id?ue.slice(0,2).map((e=>({...e,orgId:1,realName:e.realName.replace("员工","总监"),roles:[{id:1,rolesCode:"director",rolesName:"总监",rolesType:0}]}))):[]}const l=(Re.value-1)*$e.value,o=l+$e.value;Ae.value=a.slice(l,o),Oe.value=a.length}}catch(e){console.error("获取组织成员失败",e),de(e,"获取组织成员失败"),Ae.value=[],Oe.value=0}finally{Me.value=!1}}},la=e=>{$e.value=e,aa()},oa=e=>{Re.value=e,aa()},ra=()=>{Se.value=!1,je.id=void 0,je.orgName="",je.orgCode="",je.parentId=void 0,je.orgPhone="",je.orgMail="",je.state=1,je.description="";const e=se();console.log("添加组织设置租户ID:",e),je.tenantId=e,t((()=>{Ue.value&&Ue.value.clearValidate()})),Pe.value=!0},ta=e=>{Se.value=!0,je.id=e.id,je.orgName=e.orgName,je.orgCode=e.orgCode,je.parentId=e.parentId,je.orgPhone=e.orgPhone||"",je.orgMail=e.orgMail||"",je.state=e.state,je.description=e.description||"";const a=e.tenantId?String(e.tenantId):se();console.log("编辑组织设置租户ID:",a),je.tenantId=a,t((()=>{Ue.value&&Ue.value.clearValidate()})),Pe.value=!0},da=e=>{e.children&&e.children.length>0?b.warning("该组织下有子组织，不能删除"):P.confirm(`确定要删除组织 "${e.orgName}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{const l=await(a=e.id,oe({url:`/org/api/org/organizations/${a}`,method:"delete"}));l&&!0===l.data?(b.success("删除组织成功"),await Qe(),xe.value.id===e.id&&(xe.value={})):(console.error("删除组织失败:",l),de(l,"删除组织失败"))}catch(l){console.error("删除组织失败",l),de(l,"删除组织失败")}var a})).catch((()=>{}))},sa=async()=>{Ue.value&&await Ue.value.validate((async e=>{if(e)try{const e={...je};if(e.id&&(e.id=String(e.id)),e.parentId&&(e.parentId=String(e.parentId)),e.tenantId&&(e.tenantId=String(e.tenantId)),console.log("提交组织表单数据:",JSON.stringify(e)),Se.value&&e.id){const a=await function(e){const a={...e};return a.id&&(a.id=String(a.id)),a.parentId&&(a.parentId=String(a.parentId)),delete a.tenantId,console.log("更新组织，最终发送数据:",JSON.stringify(a)),oe({url:"/org/api/org/organizations",method:"put",data:a,headers:{"X-BigInt-Fields":"id,parentId"}})}(e);console.log("更新组织API返回:",a),a&&200===a.code?(b.success("更新组织成功"),Pe.value=!1,await Qe(),xe.value.id===e.id&&await ea()):(console.error("更新组织失败:",a),de(a,"更新组织失败"))}else{const a=await function(e){const a=e.tenantId||se();console.log("创建组织，租户ID (原始):",a),console.log("创建组织，租户ID (字符串):",String(a));const l={...e};return l.id&&(l.id=String(l.id)),l.parentId&&(l.parentId=String(l.parentId)),l.tenantId=String(a),console.log("创建组织，最终发送数据:",JSON.stringify(l)),oe({url:"/org/api/org/organizations",method:"post",data:l,headers:{"X-BigInt-Fields":"tenantId,id,parentId"}})}(e);console.log("创建组织API返回:",a),a&&200===a.code?(b.success("创建组织成功"),Pe.value=!1,await Qe()):(console.error("创建组织失败:",a),de(a,"创建组织失败"))}}catch(a){console.error("保存组织失败",a),de(a,"保存组织失败")}}))},na=()=>{xe.value.id?(Le.value=!1,qe.value={},Je.id=void 0,Je.userId=void 0,Je.realName="",Je.username="",Je.email="",Je.phone="",Je.roleIds=[],Je.entryDate=new Date,Je.orgId=xe.value.id,Fe.value="",Ye.value=[],t((()=>{He.value&&He.value.clearValidate()})),Be.value=!0):b.warning("请先选择一个组织")},ia=e=>{xe.value.id&&P.confirm(`确定要从该组织中移除成员 "${e.realName}" 吗？是否同时解绑用户与租户关系？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>P.confirm("是否同时解绑用户与租户关系？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"info"}).then((()=>!0)).catch((()=>!1)))).then((async a=>{try{const l=await function(e,a,l=!1){return oe({url:"/org/api/org/members/unbind",method:"delete",params:{orgId:e,userId:a,tenantId:se(),unbindTenant:l}})}(xe.value.id,e.id,!!a);l&&!0===l.data?(b.success("移除成员成功"),aa()):(console.error("移除成员失败:",l),de(l,"移除成员失败"))}catch(l){console.error("移除成员失败",l),de(l,"移除成员失败")}})).catch((()=>{}))},ua=async()=>{if(Fe.value){Ke.value=!0;try{const a=await function(e={}){return oe({url:"/ums/api/user/users/page",method:"post",data:{...e}})}({keyword:Fe.value,pageNum:1,pageSize:10});if(a&&a.data&&a.data.records)Ye.value=a.data.records.map((e=>({id:e.id,username:e.loginName||"",realName:e.userName||"",email:e.userMail||"",phone:e.userPhone||"",roles:[],orgId:e.orgId||0}))),console.log("搜索用户成功:",Ye.value);else{console.warn("搜索用户失败，使用模拟数据:",a);const l=await(e=Fe.value,new Promise((a=>{setTimeout((()=>{const l=[...ue,{id:201,username:"john.doe",realName:"约翰·多伊",email:"john.doe@example.com",phone:"13900000001",roles:[],orgId:0},{id:202,username:"jane.smith",realName:"简·史密斯",email:"jane.smith@example.com",phone:"13900000002",roles:[],orgId:0},{id:203,username:"alex.wong",realName:"亚历克斯·王",email:"alex.wong@example.com",phone:"13900000003",roles:[],orgId:0}].filter((a=>a.username.toLowerCase().includes(e.toLowerCase())||a.realName.toLowerCase().includes(e.toLowerCase())||a.email&&a.email.toLowerCase().includes(e.toLowerCase())||a.phone&&a.phone.includes(e)));a(l)}),500)})));Ye.value=l}}catch(a){console.error("搜索用户失败",a),de(a,"搜索用户失败"),Ye.value=[]}finally{Ke.value=!1}var e}else b.warning("请输入搜索关键字")},ma=e=>{qe.value={...e},Je.userId=e.id,Je.realName=e.realName||e.username,Je.username=e.username,Je.email=e.email||"",Je.phone=e.phone||"",Je.roleIds=[],Je.entryDate=new Date,console.log("已选择用户:",e)},pa=async()=>{He.value&&xe.value.id&&await He.value.validate((async e=>{if(e)try{if(Le.value){const e=await(a=xe.value.id,l=Je.userId,o=Je.roleIds,oe({url:"/org/api/org/members/update",method:"put",data:{orgId:a,userId:l,roleIds:o,tenantId:se()}}));e&&!0===e.data?(b.success("更新成员成功"),Be.value=!1,aa()):(console.error("更新成员失败:",e),de(e,"更新成员失败"))}else{const e=await function(e,a){return oe({url:"/org/api/org/members/bind",method:"post",data:{orgId:e,userId:a.userId,roleIds:a.roleIds,tenantId:se()}})}(xe.value.id,{userId:Je.userId,roleIds:Je.roleIds});e&&!0===e.data?(b.success("添加成员成功"),Be.value=!1,aa()):(console.error("添加成员失败:",e),de(e,"添加成员失败"))}}catch(r){console.error("保存成员失败",r),de(r,"保存成员失败")}var a,l,o}))};return r((()=>{const e=se();e?console.log("当前租户ID:",e):(console.warn("未获取到租户ID，尝试从用户信息中获取"),b.warning("未获取到租户信息，可能影响组织数据的加载")),Qe(),Ze(),setTimeout((()=>{if(re.value.length>0){const e=re.value[0];xe.value={...e},t((()=>{Te.value&&Te.value.setCurrentKey(e.id)})),ea(),aa()}}),500)})),(e,a)=>{const l=S,o=U,r=j,b=z,P=A,oe=M,de=R,se=$,ne=O,ie=B,ue=L,De=H,Qe=q,Ze=J,ea=_,aa=F,ca=K,ga=Y,va=X,ha=E,fa=C,ya=G,Ia=Q,Na=Z,ba=W,_a=ee;return i(),d("div",me,[s(le,{title:"组织架构管理",subtitle:"管理公司部门与人员的层级结构"},{actions:n((()=>[s(o,{type:"primary",onClick:ra},{default:n((()=>[s(l,null,{default:n((()=>[s(u(w))])),_:1}),a[22]||(a[22]=m(" 添加组织 "))])),_:1})])),_:1}),s(ea,{gutter:20,class:"org-content"},{default:n((()=>[s(oe,{xs:24,sm:24,md:8,lg:5,class:"org-col"},{default:n((()=>[s(P,{class:"tree-card"},{header:n((()=>[p("div",pe,[a[23]||(a[23]=p("span",null,"组织架构树",-1)),s(r,{modelValue:te.value,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value=e),placeholder:"输入关键字过滤",clearable:"","prefix-icon":"Search",class:"filter-input"},null,8,["modelValue"])])])),default:n((()=>[p("div",ce,[s(b,{ref_key:"orgTreeRef",ref:Te,data:re.value,props:{label:"orgName",children:"children"},"node-key":"id","filter-node-method":Ge,"highlight-current":"",onNodeClick:We},{default:n((({node:e,data:a})=>[p("div",ge,[p("span",ve,[a.parentId?(i(),c(l,{key:1},{default:n((()=>[s(u(k))])),_:1})):(i(),c(l,{key:0},{default:n((()=>[s(u(V))])),_:1})),m(" "+g(e.label),1)]),p("span",he,"("+g(a.memberCount||a.staffCount||0)+"人)",1),p("div",fe,[s(o,{type:"primary",link:"",onClick:v((e=>ta(a)),["stop"])},{default:n((()=>[s(l,null,{default:n((()=>[s(u(T))])),_:1})])),_:2},1032,["onClick"]),a.children&&0===a.children.length?(i(),c(o,{key:0,type:"danger",link:"",onClick:v((e=>da(a)),["stop"])},{default:n((()=>[s(l,null,{default:n((()=>[s(u(D))])),_:1})])),_:2},1032,["onClick"])):h("",!0)])])])),_:1},8,["data"])])])),_:1})])),_:1}),s(oe,{xs:24,sm:24,md:16,lg:19,class:"org-col"},{default:n((()=>[xe.value.id?(i(),d(f,{key:1},[s(P,{class:"detail-card"},{header:n((()=>[p("div",Ie,[a[25]||(a[25]=p("span",null,"组织详情",-1)),p("div",null,[s(o,{type:"primary",onClick:a[1]||(a[1]=e=>ta(xe.value))},{default:n((()=>[s(l,null,{default:n((()=>[s(u(T))])),_:1}),a[24]||(a[24]=m(" 编辑 "))])),_:1})])])])),default:n((()=>[s(ie,{column:2,border:""},{default:n((()=>[s(se,{label:"组织名称",span:1},{default:n((()=>[m(g(xe.value.orgName),1)])),_:1}),s(se,{label:"组织编码",span:1},{default:n((()=>[m(g(xe.value.orgCode),1)])),_:1}),s(se,{label:"创建时间",span:1},{default:n((()=>[m(g(u(ae)(xe.value.createTime)),1)])),_:1}),s(se,{label:"最后更新",span:1},{default:n((()=>[m(g(u(ae)(xe.value.updateTime)),1)])),_:1}),s(se,{label:"联系电话",span:1},{default:n((()=>[m(g(xe.value.orgPhone||"-"),1)])),_:1}),s(se,{label:"联系邮箱",span:1},{default:n((()=>[m(g(xe.value.orgMail||"-"),1)])),_:1}),s(se,{label:"状态",span:2},{default:n((()=>[s(ne,{type:1===xe.value.state?"success":"danger"},{default:n((()=>[m(g(1===xe.value.state?"启用":"禁用"),1)])),_:1},8,["type"])])),_:1}),s(se,{label:"描述",span:2},{default:n((()=>[m(g(xe.value.description||"-"),1)])),_:1})])),_:1})])),_:1}),s(P,{class:"members-card"},{header:n((()=>[p("div",Ne,[a[27]||(a[27]=p("span",null,"部门成员",-1)),s(o,{type:"primary",onClick:na},{default:n((()=>[s(l,null,{default:n((()=>[s(u(w))])),_:1}),a[26]||(a[26]=m(" 添加成员 "))])),_:1})])])),default:n((()=>[p("div",be,[y((i(),c(Qe,{data:Ae.value,border:"",style:{width:"100%"},"max-height":"500"},{default:n((()=>[s(ue,{label:"姓名",prop:"realName","min-width":"100"}),s(ue,{label:"账号",prop:"username","min-width":"120"}),s(ue,{label:"角色","min-width":"140"},{default:n((({row:e})=>[(i(!0),d(f,null,I(e.roles,(e=>(i(),c(ne,{key:e.id,class:"role-tag"},{default:n((()=>[m(g(e.rolesName),1)])),_:2},1024)))),128)),e.roles&&0!==e.roles.length?h("",!0):(i(),d("span",_e,"-"))])),_:1}),s(ue,{label:"邮箱",prop:"email","min-width":"180"}),s(ue,{label:"电话",prop:"phone","min-width":"120"}),s(ue,{label:"入职日期","min-width":"120"},{default:n((({row:e})=>[m(g(e.entryDate?u(ae)(e.entryDate,"YYYY-MM-DD"):"-"),1)])),_:1}),s(ue,{label:"操作",width:"150",fixed:"right"},{default:n((({row:e})=>[s(o,{type:"primary",link:"",onClick:a=>{return l=e,Le.value=!0,qe.value={...l},console.log("编辑成员，角色信息:",l.roles),Je.id=l.id,Je.userId=l.id,Je.realName=l.realName,Je.username=l.username,Je.email=l.email||"",Je.phone=l.phone||"",Je.roleIds=l.roles?l.roles.map((e=>e.id)):[],Je.entryDate=l.entryDate?new Date(l.entryDate):new Date,Je.orgId=xe.value.id,t((()=>{He.value&&He.value.clearValidate()})),void(Be.value=!0);var l}},{default:n((()=>[s(l,null,{default:n((()=>[s(u(T))])),_:1})])),_:2},1032,["onClick"]),s(De,{title:"确定要移除此成员吗？",onConfirm:a=>ia(e)},{reference:n((()=>[s(o,{type:"danger",link:""},{default:n((()=>[s(l,null,{default:n((()=>[s(u(D))])),_:1})])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[_a,Me.value]]),Oe.value>0?(i(),d("div",Ce,[s(Ze,{"current-page":Re.value,"onUpdate:currentPage":a[2]||(a[2]=e=>Re.value=e),"page-size":$e.value,"onUpdate:pageSize":a[3]||(a[3]=e=>$e.value=e),"page-sizes":[10,20,50],background:"",layout:"total, sizes, prev, pager, next",total:Oe.value,onSizeChange:la,onCurrentChange:oa},null,8,["current-page","page-size","total"])])):h("",!0),0!==Ae.value.length||Me.value?h("",!0):(i(),c(de,{key:1,description:"暂无成员"}))])])),_:1})],64)):(i(),d("div",ye,[s(de,{description:"请选择一个组织查看详情"})]))])),_:1})])),_:1}),s(fa,{modelValue:Pe.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Pe.value=e),title:Se.value?"编辑组织":"新增组织",width:"500px","destroy-on-close":""},{footer:n((()=>[p("span",we,[s(o,{onClick:a[11]||(a[11]=e=>Pe.value=!1)},{default:n((()=>a[30]||(a[30]=[m("取消")]))),_:1}),s(o,{type:"primary",onClick:sa},{default:n((()=>a[31]||(a[31]=[m("确定")]))),_:1})])])),default:n((()=>[s(ha,{ref_key:"orgFormRef",ref:Ue,model:je,rules:ze,"label-width":"100px"},{default:n((()=>[s(aa,{label:"组织名称",prop:"orgName"},{default:n((()=>[s(r,{modelValue:je.orgName,"onUpdate:modelValue":a[4]||(a[4]=e=>je.orgName=e),placeholder:"请输入组织名称"},null,8,["modelValue"])])),_:1}),s(aa,{label:"组织编码",prop:"orgCode"},{default:n((()=>[s(r,{modelValue:je.orgCode,"onUpdate:modelValue":a[5]||(a[5]=e=>je.orgCode=e),placeholder:"请输入组织编码",disabled:Se.value},null,8,["modelValue","disabled"])])),_:1}),s(aa,{label:"上级组织",prop:"parentId"},{default:n((()=>[s(ca,{modelValue:je.parentId,"onUpdate:modelValue":a[6]||(a[6]=e=>je.parentId=e),options:re.value,props:{checkStrictly:!0,label:"orgName",value:"id",emitPath:!1,expandTrigger:"hover"},placeholder:"请选择上级组织",clearable:"",disabled:1===je.id,"show-all-levels":!1},{default:n((({node:e,data:a})=>[p("span",null,g(a.orgName),1)])),_:1},8,["modelValue","options","disabled"])])),_:1}),s(aa,{label:"联系电话",prop:"orgPhone"},{default:n((()=>[s(r,{modelValue:je.orgPhone,"onUpdate:modelValue":a[7]||(a[7]=e=>je.orgPhone=e),placeholder:"请输入联系电话"},null,8,["modelValue"])])),_:1}),s(aa,{label:"联系邮箱",prop:"orgMail"},{default:n((()=>[s(r,{modelValue:je.orgMail,"onUpdate:modelValue":a[8]||(a[8]=e=>je.orgMail=e),placeholder:"请输入联系邮箱"},null,8,["modelValue"])])),_:1}),s(aa,{label:"状态",prop:"state"},{default:n((()=>[s(va,{modelValue:je.state,"onUpdate:modelValue":a[9]||(a[9]=e=>je.state=e)},{default:n((()=>[s(ga,{label:1},{default:n((()=>a[28]||(a[28]=[m("启用")]))),_:1}),s(ga,{label:0},{default:n((()=>a[29]||(a[29]=[m("禁用")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),s(aa,{label:"描述",prop:"description"},{default:n((()=>[s(r,{modelValue:je.description,"onUpdate:modelValue":a[10]||(a[10]=e=>je.description=e),type:"textarea",rows:3,placeholder:"请输入组织描述信息"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),s(fa,{modelValue:Be.value,"onUpdate:modelValue":a[21]||(a[21]=e=>Be.value=e),title:Le.value?"编辑成员":"添加成员",width:"650px","destroy-on-close":""},{footer:n((()=>[p("span",ke,[s(o,{onClick:a[20]||(a[20]=e=>Be.value=!1)},{default:n((()=>a[36]||(a[36]=[m("取消")]))),_:1}),s(o,{type:"primary",onClick:pa,disabled:!Le.value&&!qe.value.id},{default:n((()=>a[37]||(a[37]=[m(" 确定 ")]))),_:1},8,["disabled"])])])),default:n((()=>[Le.value?h("",!0):(i(),d("div",Ve,[a[34]||(a[34]=p("div",{class:"search-header"},[p("h4",null,"搜索已注册用户")],-1)),s(r,{modelValue:Fe.value,"onUpdate:modelValue":a[13]||(a[13]=e=>Fe.value=e),placeholder:"输入姓名、电话或邮箱搜索用户...",clearable:"",class:"search-input",onKeyup:N(ua,["enter"])},{prefix:n((()=>[s(l,null,{default:n((()=>[s(u(x))])),_:1})])),append:n((()=>[s(o,{onClick:ua},{default:n((()=>a[32]||(a[32]=[m(" 搜索 ")]))),_:1})])),_:1},8,["modelValue"]),Ye.value.length>0?(i(),c(Qe,{key:0,data:Ye.value,height:"200px",onRowClick:ma,"highlight-current-row":"",class:"search-results-table",border:""},{default:n((()=>[s(ue,{label:"姓名",prop:"realName","min-width":"100"}),s(ue,{label:"账号",prop:"username","min-width":"120"}),s(ue,{label:"邮箱",prop:"email","min-width":"180"}),s(ue,{label:"电话",prop:"phone","min-width":"120"}),s(ue,{label:"操作",width:"80",fixed:"right"},{default:n((({row:e})=>[s(o,{type:"primary",link:"",onClick:v((a=>ma(e)),["stop"])},{default:n((()=>a[33]||(a[33]=[m(" 选择 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):Fe.value&&!Ke.value?(i(),c(de,{key:1,description:"未找到匹配的用户"})):h("",!0)])),!Le.value&&qe.value.id?(i(),c(ya,{key:1},{default:n((()=>a[35]||(a[35]=[m("用户信息")]))),_:1})):h("",!0),y((i(),c(ha,{ref_key:"memberFormRef",ref:He,model:Je,rules:Ee,"label-width":"100px"},{default:n((()=>[s(aa,{label:"姓名",prop:"realName"},{default:n((()=>[s(r,{modelValue:Je.realName,"onUpdate:modelValue":a[14]||(a[14]=e=>Je.realName=e),placeholder:"请输入姓名",disabled:""},null,8,["modelValue"])])),_:1}),s(aa,{label:"账号",prop:"username"},{default:n((()=>[s(r,{modelValue:Je.username,"onUpdate:modelValue":a[15]||(a[15]=e=>Je.username=e),placeholder:"请输入账号",disabled:""},null,8,["modelValue"])])),_:1}),s(aa,{label:"角色",prop:"roleIds"},{default:n((()=>[s(Na,{modelValue:Je.roleIds,"onUpdate:modelValue":a[16]||(a[16]=e=>Je.roleIds=e),multiple:"",filterable:"",placeholder:"请选择角色",style:{width:"100%"},clearable:""},{default:n((()=>[(i(!0),d(f,null,I(Xe.value,(e=>(i(),c(Ia,{key:e.id,label:e.rolesName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(aa,{label:"邮箱",prop:"email"},{default:n((()=>[s(r,{modelValue:Je.email,"onUpdate:modelValue":a[17]||(a[17]=e=>Je.email=e),placeholder:"请输入邮箱",disabled:""},null,8,["modelValue"])])),_:1}),s(aa,{label:"电话",prop:"phone"},{default:n((()=>[s(r,{modelValue:Je.phone,"onUpdate:modelValue":a[18]||(a[18]=e=>Je.phone=e),placeholder:"请输入电话",disabled:""},null,8,["modelValue"])])),_:1}),s(aa,{label:"入职日期",prop:"entryDate"},{default:n((()=>[s(ba,{modelValue:Je.entryDate,"onUpdate:modelValue":a[19]||(a[19]=e=>Je.entryDate=e),type:"date",placeholder:"选择入职日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])),[[_a,Ke.value]])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-4023fb15"]]);export{Te as default};
